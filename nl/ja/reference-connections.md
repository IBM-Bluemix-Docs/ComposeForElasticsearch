---
copyright:
  years: 2016,2018
lastupdated: "2018-06-18"
---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}
{:tip: .tip}

# 接続構成
{: #connection-configuration}

{{site.data.keyword.composeForElasticsearch_full}} データベース接続は、2 つの HAProxy ポータルによって管理されます。 各ポータルのメモリーは 64 MB です。

ポータルが 2 つあるので、そのうち 1 つが到達不能になっても、アプリケーションは接続性を維持できます。 クライアント・サイドのフェイルオーバーは、アプリケーション設計者の責任です。 一部の Elasticsearch ドライバーは、自動的に複数の接続ストリングを処理してフェイルオーバーを正常終了します。

フェイルオーバー・エラーを完全に処理するドライバーを使用して作業するのでない場合は、以下のステップを実行して、手動でエラーを処理してください。

* 接続構成で複数のエンドポイントを受け入れるドライバーを使用する。
* アプリケーションがデータベースとの間で読み書きを行う際に適切にエラーに対応することを確認する。 以下のようなさまざまな方法で、エラーに対応するようにアプリケーションを構成できます。
  + エラーをログに記録し、再接続する。
  + 再接続し、エラーの原因となった操作を再試行する。
  + 失敗した操作をキューイングして再接続をスケジュールに入れる。

## 転送中の暗号化

すべての {{site.data.keyword.composeForElasticsearch}} HAProxy ポータルは、TLS/SSL 対応になっており、TLS バージョン  1.2 をサポートします。 サービスに関する証明書は、Let's Encrypt 証明書です。

## 接続制限

2 つの HAProxy ポータルには、ポータルあたり 2000 接続という接続制限があります。 この接続制限を超えると、サービスが無応答になる可能性があります。 ドライバーの接続プーリング機能を使用して、アプリケーションからの接続を管理できます。

## プロキシーのタイムアウト

HAProxy ポータルは、サーバーとクライアントとの間の接続のライフサイクルを管理します。 ドライバーの作成者や、{{site.data.keyword.composeForElasticsearch}} データベース接続の低水準のアクティビティーに関心がある方のための参照ガイドとして、タイムアウト値の詳細を以下の部分で説明します。

設定 | 値 | 適用対象
----------|-----------|-----------
client | 1m | クライアントによるデータの確認応答または送信が予期される時間。
connect | 9s | プロキシーとサーバーの間の接続が行われる時間。
server | 2m | サーバーによるデータの確認応答または送信が予期される時間。
check | 5s | プロキシーとサーバーの間の接続が行われる時間の 2 次タイムアウト・チェックとして。
http-request | 5s | 完全な HTTP 要求を待機する最大許可時間。
{: caption="表 1. Elasticsearch HAProxy のタイムアウト" caption-side="top"}
